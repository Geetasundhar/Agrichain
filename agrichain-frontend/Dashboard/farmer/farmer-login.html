<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>AgriChain - Farmer Login</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<script src="https://unpkg.com/i18next@22.4.9/i18next.min.js"></script>
<script src="https://unpkg.com/i18next-browser-languagedetector@7.2.1/i18nextBrowserLanguageDetector.min.js"></script>

<style>
*{margin:0;padding:0;box-sizing:border-box;font-family:Arial,sans-serif;}
html, body{height:100%;overflow-x:hidden;scroll-behavior:smooth;}

/* Background image with overlay */
body{
  background: 
    linear-gradient(rgba(168,224,99,0.5), rgba(86,171,47,0.5)),
    url('../../images/login.jpg') no-repeat center top;
  background-size: 100% auto;
  background-attachment: scroll;
  display:flex;
  flex-direction:column;
  transition: background 0.5s ease;
}

/* Header */
header{
  background: rgba(25,105,44,0.95);
  padding:15px 20px;
  display:flex;
  justify-content:space-between;
  align-items:center;
  color:white;
  flex-wrap:wrap;
  transition: all 0.3s ease;
}
header img{height:60px;border-radius:10px;transition: transform 0.4s ease;}
header img:hover{transform:scale(1.15);}
nav { display:flex; gap:20px; flex-wrap:wrap; justify-content:center; transition: all 0.3s ease;}
nav a { text-decoration:none; color:#f3f7f4; font-weight:600; transition:0.3s; font-size:1.05em; }
nav a:hover { color:#ffeaa7; transform:scale(1.1);}
.language-toggle button{
  margin-left:10px;
  padding:6px 12px;
  border:none;
  border-radius:6px;
  background:#f5f4f3;
  color:#19692c;
  font-weight:bold;
  cursor:pointer;
  transition:0.3s;
}
.language-toggle button:hover{
  background:#19692c;
  color:white;
}

/* Title */
.title{
  text-align:center;
  margin:25px 0;
  color:#19692c;
  font-size:2.4rem;
  letter-spacing:1px;
  text-shadow: 1px 1px 3px #fff;
  animation:fadeInDown 1s ease forwards;
}

/* Login Form Section */
main{
  flex:1;
  display:flex;
  justify-content:center;
  align-items:flex-start;
  padding:20px 0;
}
.section{
  width:90%;
  max-width:500px;
  padding:35px;
  background: rgba(255,255,255,0.9);
  border-radius:20px;
  box-shadow:0 10px 30px rgba(13, 13, 13, 0.3);
  position:relative;
  overflow:hidden;
  animation:fadeInUp 1s ease forwards;
  transition: all 0.3s ease;
}
.section:hover{
  transform: translateY(-5px);
  box-shadow:0 15px 35px rgba(0,0,0,0.35);
}

/* Floating Labels with Icons */
.section .form-group{
  position:relative;
  margin-bottom:25px;
}
.section .form-group i{
  position:absolute;
  left:12px;
  top:50%;
  transform:translateY(-50%);
  color:#211f1f;
  transition: all 0.3s ease;
}
.section input{
  width:100%;
  padding:14px 12px 14px 38px;
  font-size:16px;
  border:2px solid #0a0909;
  border-radius:10px;
  outline:none;
  transition: all 0.3s ease;
  background:transparent;
}
.section input:focus{
  border-color:#27ae60;
  box-shadow:0 0 12px rgba(39,174,96,0.4);
}
.section label{
  position:absolute;
  top:14px;
  left:38px;
  background:white;
  padding:0 5px;
  color:#131212;
  font-weight:bold;
  pointer-events:none;
  transition:0.3s ease all;
}
.section input:focus + label,
.section input:not(:placeholder-shown) + label{
  top:-10px;
  left:30px;
  color:#27ae60;
  font-size:13px;
}
.section input:focus ~ i{ color:#27ae60; }

/* Password Toggle */
.password-toggle{
  position:absolute;
  right:12px;
  top:50%;
  transform:translateY(-50%);
  cursor:pointer;
  color:#999;
  transition:0.3s;
}
.password-toggle:hover{color:#27ae60;}

/* Button with ripple effect */
.section button{
  position:relative;
  overflow:hidden;
  width:100%;
  padding:14px;
  background-color:#27ae60;
  border:none;
  border-radius:10px;
  color:white;
  font-size:18px;
  cursor:pointer;
  font-weight:bold;
  transition: all 0.3s ease;
}
.section button:hover{
  background-color:#19692c;
  transform:scale(1.05);
  box-shadow:0 8px 20px rgba(0,0,0,0.3);
}
.section button:active{
  transform:scale(0.98);
}

/* Register link */
.login-link{
  text-align:center;
  margin-top:15px;
  font-size:16px;
  transition: all 0.3s ease;
}
.login-link a{
  color:#19692c;
  text-decoration:none;
  font-weight:bold;
  transition: all 0.3s ease;
}
.login-link a:hover{
  color:#27ae60;
  text-decoration:underline;
}

/* Footer */
footer{
  background: rgba(25,105,44,0.95);
  color:white;
  text-align:center;
  padding:15px;
  font-weight:bold;
}

/* Animations */
@keyframes fadeInUp{from{opacity:0;transform:translateY(30px);}to{opacity:1;transform:translateY(0);} }
@keyframes fadeInDown{from{opacity:0;transform:translateY(-30px);}to{opacity:1;transform:translateY(0);} }

@media(max-width:600px){
  header{flex-direction:column;align-items:flex-start;}
}
</style>
</head>
<body>

<header>
  <img src="../../images/logo.png" alt="AgriChain Logo">
  <nav>
    <a href="../../index.html" class="active" data-i18n="nav-home">Home</a>
    <a href="../../All/about.html" data-i18n="nav-about">About</a>
    <a href="../../instruction/farmerinstruction.html" data-i18n="nav-farmer">Farmer</a>
    <a href="../../instruction/buyerinstruction.html" data-i18n="nav-buyer">Buyer</a>
    <a href="../../instruction/admininstruction.html" data-i18n="nav-admin">Admin</a>
    <a href="../../instruction/trnsportinstruction.html" data-i18n="nav-transporter">Transporter</a>
    <a href="../instruction/insuranceinstruction.html" data-i18n="nav-insurance">Insurance</a>
  </nav>
  <div class="language-toggle">
    <button onclick="changeLng('en')">English</button>
    <button onclick="changeLng('ta')">தமிழ்</button>
  </div>
</header>

<h2 class="title" data-i18n="login-title">FarmPass</h2>

<main>
  <div class="section">
    <form id="loginForm">
      <div class="form-group">
        <input type="email" id="email" name="email" required placeholder=" ">
        <label for="email" data-i18n="label-username">Email</label>
        <i class="fa fa-user-circle"></i>
      </div>

      <div class="form-group">
        <input type="password" id="password" name="password" required placeholder=" ">
        <label for="password" data-i18n="label-password">Password</label>
        <i class="fa fa-lock"></i>
        <span class="password-toggle" onclick="togglePassword()">
          <i class="fa fa-eye"></i>
        </span>
      </div>

      <button type="submit" data-i18n="btn-login">Login</button>
    </form>

    <div class="login-link">
      <span data-i18n="not-registered">New to AgriChain?</span> 
      <a href="../../All/signup.html" data-i18n="signup-link">Signup</a>
    </div>
  </div>
</main>

<footer>
  <p data-i18n="footer-text">© 2025 AgriChain. All Rights Reserved.</p>
</footer>

<script>
const resources = {
  en: { translation: {
    "nav-home":"Home","nav-about":"About","nav-contact":"Contact","nav-farmer":"Farmer","nav-buyer":"Buyer","nav-transporter":"Transporter","nav-admin":"Admin","nav-insurance":"Insurance",
    "login-title":"FarmPass",
    "label-username":"Email","label-password":"Password","btn-login":"Login",
    "not-registered":"New to AgriChain?","signup-link":"Signup",
    "footer-text":"© 2025 AgriChain. All Rights Reserved."
  }},
  ta: { translation: {
    "nav-home":"முகப்பு","nav-about":"பற்றி","nav-contact":"தொடர்பு","nav-farmer":"விவசாயி","nav-buyer":"வாங்குபவர்","nav-transporter":"போக்குவரத்து","nav-admin":"நிர்வாகி","nav-insurance":"காப்பீடு",
    "login-title":"விவசாய நுழைவாயில்",
    "label-username":"மின்னஞ்சல்","label-password":"கடவுச்சொல்","btn-login":"உள்நுழைய",
    "not-registered":"புதிய விவசாயியா?","signup-link":"பதிவு செய்யவும்",
    "footer-text":"© 2025 அக்ரிச்செயின். எல்லா உரிமைகளும் பாதுகாக்கப்பட்டவை."
  }}
};

i18next.use(i18nextBrowserLanguageDetector).init({ resources, fallbackLng:'en' }, () => updateTexts());
function changeLng(lang){ i18next.changeLanguage(lang, () => updateTexts()); }
function updateTexts(){ document.querySelectorAll('[data-i18n]').forEach(el => { el.innerHTML = i18next.t(el.getAttribute('data-i18n')); }); }

function togglePassword(){
  const pass = document.getElementById('password');
  const icon = document.querySelector('.password-toggle i');
  if(pass.type === 'password'){ pass.type = 'text'; icon.classList.replace('fa-eye','fa-eye-slash'); }
  else { pass.type = 'password'; icon.classList.replace('fa-eye-slash','fa-eye'); }
}

// ✅ Handle login form submission
document.getElementById("loginForm").addEventListener("submit", async (e) => {
  e.preventDefault();
  const email = document.getElementById("email").value.trim();
  const password = document.getElementById("password").value.trim();
  if (!email || !password) { alert("Please fill all fields"); return; }

  try {
    const response = await fetch("http://localhost:5000/auth/login", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ email, password }),
    });

    const data = await response.json();
    if (response.ok) {
      alert("Login successful!");
      localStorage.setItem("token", data.token);
      localStorage.setItem("userId", data.userId);
      // Correct relative path to dashboard
      window.location.href = "farmer-dashboard.html";
    } else {
      alert(data.message || "Invalid email or password");
    }
  } catch (err) {
    console.error(err);
    alert("Server error. Please try again later.");
  }
});
</script>

</body>
</html>