<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>AgriChain - Crop Report</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<script src="https://cdn.canvasjs.com/canvasjs.min.js"></script>
<script src="https://unpkg.com/i18next@23.4.6/dist/umd/i18next.min.js"></script>
<script src="https://unpkg.com/i18next-browser-languagedetector@7.2.1/i18nextBrowserLanguageDetector.min.js"></script>

<style>
* { margin:0; padding:0; box-sizing:border-box; font-family:'Poppins', sans-serif; }
body { background:url('../../images/croprepo.jpg') no-repeat center center/cover; color:#333; display:flex; flex-direction:column; min-height:50vh; transition:background 1s ease-in-out; }

/* HEADER */
header { background:linear-gradient(90deg,#1b5e20,#2e7d32); color:white; display:flex; align-items:center; justify-content:space-between; padding:15px 30px; box-shadow:0 4px 10px rgba(0,0,0,0.3); flex-wrap:wrap; }
header img { height:60px; border-radius:8px; transition:transform 0.3s; }
header img:hover { transform:scale(1.1); }
nav a { color:white; text-decoration:none; margin:0 10px; font-weight:600; position:relative; transition:color 0.3s, transform 0.3s; }
nav a::after { content:""; position:absolute; left:0; bottom:-4px; width:0%; height:2px; background:white; transition:width 0.3s; }
nav a:hover::after { width:100%; }
.language-toggle button { background:white; color:#1b5e20; border:none; font-weight:600; padding:6px 10px; border-radius:8px; margin-left:8px; cursor:pointer; transition:0.3s; }
.language-toggle button:hover { background:#c8e6c9; transform:scale(1.1); }

/* MAIN SECTION */
section.report { background:rgba(255,255,255,0.95); margin:40px auto; width:90%; max-width:1100px; border-radius:15px; padding:40px 30px; box-shadow:0 8px 25px rgba(0,0,0,0.3); animation:fadeIn 1s ease-in-out; text-align:center; }
.report h2 { color:#1b5e20; font-size:2.5em; margin-bottom:15px; animation:slideDown 1s ease-in-out; }
.report p { font-size:1.1em; margin-bottom:30px; color:#444; }
.report-details { display:flex; flex-wrap:wrap; justify-content:center; gap:25px; margin-top:30px; }
.detail-card { background:white; flex:1 1 300px; padding:25px; border-radius:15px; box-shadow:0 6px 15px rgba(0,0,0,0.2); transition:transform 0.4s, box-shadow 0.4s; cursor:pointer; }
.detail-card:hover { transform:translateY(-8px); box-shadow:0 12px 25px rgba(0,0,0,0.3); }
.detail-card h3 { color:#1b5e20; margin-bottom:10px; }
.detail-card p { color:#555; }

/* CHART */
#chartContainer { height:350px; width:100%; max-width:800px; margin:50px auto; background: rgba(255,255,255,0.9); border-radius:15px; box-shadow:0 6px 20px rgba(0,0,0,0.3); padding:15px; }

/* BACK BUTTON */
.back-btn a { display:inline-block; background:#1b5e20; color:white; padding:10px 25px; border-radius:10px; text-decoration:none; font-weight:bold; transition:background 0.3s, transform 0.3s; margin-top:25px; }
.back-btn a:hover { background:#0f4d23; transform:scale(1.05); }

/* FOOTER */
footer { background:linear-gradient(90deg,#1b5e20,#2e7d32); color:white; text-align:center; padding:25px 15px; border-top:4px solid #a5d6a7; margin-top:auto; }
footer h2 {color:#c8e6c9;}
footer a { color:white; margin:0 8px; text-decoration:none; font-weight:bold; }
footer a:hover { color:#a5d6a7; }
footer .social i { margin:0 6px; transition:0.3s; }
footer .social i:hover { transform:scale(1.3); color:#a5d6a7; }

/* ANIMATIONS */
@keyframes fadeIn { from {opacity:0; transform:translateY(30px);} to {opacity:1; transform:translateY(0);} }
@keyframes slideDown { from {opacity:0; transform:translateY(-20px);} to {opacity:1; transform:translateY(0);} }

@media(max-width:768px){
  header { flex-direction:column; gap:10px; }
  nav { text-align:center; }
  .report h2 { font-size:2em; }
  .report-details { flex-direction:column; align-items:center; }
}
</style>
</head>

<body>
<header>
  <img src="../../images/logo.png" alt="AgriChain Logo">
  <nav>
    <a href="../../index.html" data-i18n="nav-home">Home</a>
    <a href="../../All/about.html" data-i18n="nav-about">About</a>
    <a href="../../Dashboard/farmer/farmer-dashboard.html" data-i18n="nav-farmer">Farmer</a>
    <a href="#" data-i18n="nav-buyer">Buyer</a>
    <a href="#" data-i18n="nav-admin">Admin</a>
    <a href="#" data-i18n="nav-transporter">Transporter</a>
    <a href="#" data-i18n="nav-insurance">Insurance</a>
  </nav>
  <div class="language-toggle">
    <button onclick="changeLng('en')">English</button>
    <button onclick="changeLng('ta')">родрооро┐ро┤рпН</button>
  </div>
</header>

<section class="report">
  <h2 data-i18n="crop.title">ЁЯМ▒ Crop Report</h2>
  <p data-i18n="crop.text">Detailed insights into crop growth, yield, and harvest performance.</p>

  <!-- Chart -->
  <div id="chartContainer"></div>

  <!-- Crop Details -->
  <div class="report-details" id="report-container">
    <div class="detail-card">
      <h3 data-i18n="growth.title">ЁЯМ┐ Growth Stage</h3>
      <p data-i18n="growth.text">Current crop stage: <strong>Flowering</strong></p>
      <p data-i18n="growth.harvest">Expected harvest: <strong>45 days</strong></p>
    </div>
    <div class="detail-card">
      <h3 data-i18n="yield.title">ЁЯУК Yield Prediction</h3>
      <p data-i18n="yield.text">Estimated yield: <strong>1200 kg</strong></p>
      <p data-i18n="yield.based">Based on soil and water analysis.</p>
    </div>
    <div class="detail-card">
      <h3 data-i18n="harvest.title">ЁЯМ╛ Harvest Summary</h3>
      <p data-i18n="harvest.last">Last harvest: <strong>950 kg</strong></p>
      <p data-i18n="harvest.profit">Profit margin: <strong>15%</strong></p>
    </div>
  </div>

  <div class="back-btn">
    <a href="../../All/reports.html" data-i18n="back">тмЕ Back to Reports</a>
  </div>
</section>

<footer>
  <h2 data-i18n="footer-brand">AgriChain</h2>
  <p data-i18n="footer-text">Empowering farmers, ensuring transparency, and connecting directly with buyers through blockchain technology.</p>
  <div class="social">
    <a href="https://facebook.com" target="_blank"><i class="fab fa-facebook-f"></i></a>
    <a href="https://wa.me/+919514954142" target="_blank"><i class="fab fa-whatsapp"></i></a>
    <a href="https://twitter.com" target="_blank"><i class="fab fa-twitter"></i></a>
  </div>
  <p data-i18n="footer-bottom">┬й 2025 AgriChain. All Rights Reserved.</p>
</footer>

<script>
// ЁЯМН Language Support
const resources = {
  en: {translation:{
    "nav-home":"Home","nav-about":"About","nav-farmer":"Farmer","nav-buyer":"Buyer","nav-admin":"Admin","nav-transporter":"Transporter","nav-insurance":"Insurance",
    "crop.title":"ЁЯМ▒ Crop Report","crop.text":"Detailed insights into crop growth, yield, and harvest performance.","back":"тмЕ Back to Reports",
    "growth.title":"ЁЯМ┐ Growth Stage","growth.text":"Current crop stage: <strong>Flowering</strong>","growth.harvest":"Expected harvest: <strong>45 days</strong>",
    "yield.title":"ЁЯУК Yield Prediction","yield.text":"Estimated yield: <strong>1200 kg</strong>","yield.based":"Based on soil and water analysis.",
    "harvest.title":"ЁЯМ╛ Harvest Summary","harvest.last":"Last harvest: <strong>950 kg</strong>","harvest.profit":"Profit margin: <strong>15%</strong>",
    "footer-text":"Empowering farmers, ensuring transparency, and connecting directly with buyers through blockchain technology.",
    "footer-brand":"AgriChain","footer-bottom":"┬й 2025 AgriChain. All Rights Reserved."
  }},
  ta: {translation:{
    "nav-home":"роорпБроХрокрпНрокрпБ","nav-about":"рокро▒рпНро▒ро┐","nav-farmer":"ро╡ро┐ро╡роЪро╛ропро┐","nav-buyer":"ро╡ро╛роЩрпНроХрпБрокро╡ро░рпН","nav-admin":"роиро┐ро░рпНро╡ро╛роХро┐","nav-transporter":"рокрпЛроХрпНроХрпБро╡ро░родрпНродрпБ","nav-insurance":"роХро╛рокрпНрокрпАроЯрпБ",
    "crop.title":"ЁЯМ▒ рокропро┐ро░рпН роЕро▒ро┐роХрпНроХрпИ","crop.text":"рокропро┐ро░рпН ро╡ро│ро░рпНроЪрпНроЪро┐, ро╡ро┐ро│рпИроЪрпНроЪро▓рпН рооро▒рпНро▒рпБроорпН роЕро▒рпБро╡роЯрпИ роЪрпЖропро▓рпНродро┐ро▒ройрпН рокро▒рпНро▒ро┐роп ро╡ро┐ро░ро┐ро╡ро╛рой рокро╛ро░рпНро╡рпИ.","back":"тмЕ роЕро▒ро┐роХрпНроХрпИроХро│рпБроХрпНроХрпБродрпН родро┐ро░рпБроорпНрокро╡рпБроорпН",
    "growth.title":"ЁЯМ┐ ро╡ро│ро░рпНроЪрпНроЪро┐ роиро┐ро▓рпИ","growth.text":"родро▒рпНрокрпЛродрпИроп рокропро┐ро░рпН роиро┐ро▓рпИ: <strong>рокрпВроХрпНроХро│рпН роЕроЯрпИроирпНрод роиро┐ро▓рпИ</strong>","growth.harvest":"роОродро┐ро░рпНрокро╛ро░рпНроХрпНроХрокрпНрокроЯрпБроорпН роЕро▒рпБро╡роЯрпИ: <strong>45 роиро╛роЯрпНроХро│рпН</strong>",
    "yield.title":"ЁЯУК ро╡ро┐ро│рпИроЪрпНроЪро▓рпН роХрогро┐рокрпНрокрпБ","yield.text":"роорпВро▓рпНропрооро┐роЯрокрпНрокроЯрпНроЯ ро╡ро┐ро│рпИроЪрпНроЪро▓рпН: <strong>1200 роХро┐ро▓рпЛ</strong>","yield.based":"роорогрпН рооро▒рпНро▒рпБроорпН роирпАро░рпН рокро░ро┐роЪрпЛродройрпИ роЕроЯро┐рокрпНрокроЯрпИропро┐ро▓рпН.",
    "harvest.title":"ЁЯМ╛ роЕро▒рпБро╡роЯрпИ роЪрпБро░рпБроХрпНроХроорпН","harvest.last":"роХроЯрпИроЪро┐ роЕро▒рпБро╡роЯрпИ: <strong>950 роХро┐ро▓рпЛ</strong>","harvest.profit":"ро▓ро╛рок ро╡ро┐роХро┐родроорпН: <strong>15%</strong>",
    "footer-text":"ро╡ро┐ро╡роЪро╛ропро┐роХро│рпИ ро╡ро▓рпБрокрпНрокроЯрпБродрпНродро┐, родрпЖро│ро┐ро╡рпБродрпНродройрпНроорпИропрпИ роЙро▒рпБродро┐ роЪрпЖропрпНродрпБ, роирпЗро░роЯро┐ропро╛роХ ро╡ро╛роЯро┐роХрпНроХрпИропро╛ро│ро░рпНроХро│рпБроЯройрпН роЗрогрпИроХрпНроХрпБроорпН родро│роорпН.",
    "footer-brand":"роЕроХрпНро░ро┐роЪрпНроЪрпЖропро┐ройрпН","footer-bottom":"┬й 2025 роЕроХрпНро░ро┐роЪрпНроЪрпЖропро┐ройрпН. роОро▓рпНро▓ро╛ роЙро░ро┐роорпИроХро│рпБроорпН рокро╛родрпБроХро╛роХрпНроХрокрпНрокроЯрпНроЯро╡рпИ."
  }}
};

let chart; // global chart variable

// Initialize i18next
i18next.use(i18nextBrowserLanguageDetector).init({
  resources,
  fallbackLng:'en'
}, updateContent);

function updateContent(){
  document.querySelectorAll('[data-i18n]').forEach(el=>{
    el.innerHTML=i18next.t(el.getAttribute('data-i18n'));
  });
  if(chart && chart.data){
    chart.options.title.text = i18next.t('crop.title') + " - Profit Margin";
    chart.render();
  }
}

function changeLng(lang){
  i18next.changeLanguage(lang, updateContent);
}

// ЁЯМ▒ Fetch chart data dynamically from API
async function loadChartData() {
  try {
    const res = await fetch("http://localhost/agrichain/api/get_crop_report.php");
    const data = await res.json();

    const chartDataPoints = data.map(item => ({
      label: item.crop_name,
      y: parseFloat(item.profit_margin)
    }));

    chart = new CanvasJS.Chart("chartContainer", {
      theme:"light2",
      animationEnabled:true,
      exportEnabled:true,
      title: { text:i18next.t('crop.title') + " - Profit Margin" },
      legend: { cursor:"pointer", fontSize:14, fontFamily:"Poppins" },
      data: [{
        type:"pie",
        startAngle:25,
        showInLegend:true,
        legendText:"{label}",
        indexLabelFontSize:16,
        indexLabel:"{label} - {y}%",
        dataPoints: chartDataPoints
      }],
      credit: false // remove watermark
    });
    chart.render();
  } catch (err) {
    document.getElementById("chartContainer").innerHTML = "<p>тЪая╕П Failed to load chart data.</p>";
  }
}
loadChartData();
</script>
</body>
</html>
