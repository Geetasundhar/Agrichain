<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title data-i18n="title">AgriChain - Storage Report</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://unpkg.com/i18next@23.7.6/dist/umd/i18next.min.js"></script>
<script src="https://unpkg.com/i18next-browser-languagedetector@7.2.1/dist/umd/i18nextBrowserLanguageDetector.min.js"></script>

<style>
body {
  font-family: "Poppins", sans-serif;
  margin: 0; padding: 0;
  background: #f2f6f4;
  color: #1e4620;
}

header {
  background: #19692c;
  color: white;
  text-align: center;
  padding: 1rem;
  font-size: 1.5rem;
}

.lang-switch {
  position: absolute;
  right: 20px;
  top: 15px;
}

.lang-switch button {
  background: white;
  border: none;
  color: #19692c;
  padding: 5px 10px;
  margin-left: 5px;
  border-radius: 6px;
  cursor: pointer;
  font-weight: bold;
}

section {
  padding: 2rem;
  text-align: center;
}

.chart-container {
  max-width: 900px;
  margin: 40px auto;
  background: white;
  padding: 20px;
  border-radius: 20px;
  box-shadow: 0 4px 10px rgba(0,0,0,0.1);
}

button.chart-toggle {
  background: #19692c;
  color: white;
  border: none;
  margin: 5px;
  padding: 8px 16px;
  border-radius: 6px;
  cursor: pointer;
  font-weight: bold;
}

button.chart-toggle:hover {
  background: #145822;
}

footer {
  background: #19692c;
  color: white;
  text-align: center;
  padding: 1rem;
  font-size: 0.9rem;
  margin-top: 40px;
}

@media(max-width: 600px) {
  .chart-container { padding: 10px; }
  button.chart-toggle { padding: 6px 10px; font-size: 0.85rem; }
}
</style>
</head>

<body>
<header>
  <span data-i18n="storage-title">üè¨ Storage Report</span>
  <div class="lang-switch">
    <button onclick="setLanguage('en')">EN</button>
    <button onclick="setLanguage('ta')">TA</button>
  </div>
</header>

<section>
  <p data-i18n="storage-text">Monitor crop storage, available stock, and warehouse conditions.</p>

  <div class="chart-container">
    <canvas id="storageChart"></canvas>
  </div>

  <div>
    <button class="chart-toggle" onclick="changeChartType('bar')">Bar Chart</button>
    <button class="chart-toggle" onclick="changeChartType('pie')">Pie Chart</button>
    <button class="chart-toggle" onclick="changeChartType('line')">Line Chart</button>
  </div>
</section>

<footer>
  <p data-i18n="footer-text">¬© 2025 AgriChain. Empowering farmers with technology.</p>
</footer>

<script>
// üåê LANGUAGE SUPPORT
const resources = {
  en: { translation: {
    "storage-title":"üè¨ Storage Report",
    "storage-text":"Monitor crop storage, available stock, and warehouse conditions.",
    "footer-text":"¬© 2025 AgriChain. Empowering farmers with technology."
  }},
  ta: { translation: {
    "storage-title":"üè¨ ‡Æö‡Øá‡ÆÆ‡Æø‡Æ™‡Øç‡Æ™‡ØÅ ‡ÆÖ‡Æ±‡Æø‡Æï‡Øç‡Æï‡Øà",
    "storage-text":"‡Æ™‡ÆØ‡Æø‡Æ∞‡Øç ‡Æö‡Øá‡ÆÆ‡Æø‡Æ™‡Øç‡Æ™‡ØÅ, ‡Æï‡Æø‡Æü‡Øà‡Æï‡Øç‡Æï‡ØÅ‡ÆÆ‡Øç ‡Æ™‡Æô‡Øç‡Æï‡ØÅ ‡ÆÆ‡Æ±‡Øç‡Æ±‡ØÅ‡ÆÆ‡Øç ‡Æï‡Æ≥‡Æû‡Øç‡Æö‡Æø‡ÆØ ‡Æ®‡Æø‡Æ≤‡Øà‡Æï‡Æ≥‡Øà ‡Æï‡Æ£‡Øç‡Æï‡Ææ‡Æ£‡Æø‡Æï‡Øç‡Æï‡Æµ‡ØÅ‡ÆÆ‡Øç.",
    "footer-text":"¬© 2025 ‡ÆÖ‡Æï‡Øç‡Æ∞‡Æø‡Æö‡Øç‡Æö‡ØÜ‡ÆØ‡Æø‡Æ©‡Øç. ‡Æ§‡Øä‡Æ¥‡Æø‡Æ≤‡Øç‡Æ®‡ØÅ‡Æü‡Øç‡Æ™‡Æ§‡Øç‡Æ§‡Æø‡Æ©‡Øç ‡ÆÆ‡ØÇ‡Æ≤‡ÆÆ‡Øç ‡Æµ‡Æø‡Æµ‡Æö‡Ææ‡ÆØ‡Æø‡Æï‡Æ≥‡Øà ‡Æµ‡Æ≤‡ØÅ‡Æ™‡Øç‡Æ™‡Æü‡ØÅ‡Æ§‡Øç‡Æ§‡ØÅ‡Æï‡Æø‡Æ±‡Æ§‡ØÅ."
  }}
};

i18next.use(i18nextBrowserLanguageDetector).init({
  resources, fallbackLng: 'en', debug: false
}, () => updateContent());

function updateContent(){
  document.querySelectorAll('[data-i18n]').forEach(el=>{
    el.innerHTML = i18next.t(el.getAttribute('data-i18n'));
  });
}
function setLanguage(lng){ i18next.changeLanguage(lng, updateContent); }

// üìä DYNAMIC CHART
let storageChart;
let chartType = 'bar';

async function fetchStorageData() {
  try {
    // Replace with your REST API endpoint
    const response = await fetch("https://mocki.io/v1/7e24407a-9a34-4f3b-a4da-6d469c2bcb27");
    const data = await response.json();

    const labels = data.map(item => item.crop);
    const quantities = data.map(item => item.quantity);

    updateChart(labels, quantities);
  } catch (error) {
    console.error("Error fetching storage data:", error);
  }
}

function updateChart(labels, quantities) {
  const ctx = document.getElementById('storageChart').getContext('2d');
  if (storageChart) storageChart.destroy();

  storageChart = new Chart(ctx, {
    type: chartType,
    data: {
      labels: labels,
      datasets: [{
        label: 'Stored Quantity (kg)',
        data: quantities,
        backgroundColor: [
          'rgba(25,105,44,0.6)',
          'rgba(72,180,97,0.6)',
          'rgba(153, 230, 153, 0.6)',
          'rgba(200,230,153,0.6)'
        ],
        borderColor: '#19692c',
        borderWidth: 2,
        fill: true,
        tension: 0.3
      }]
    },
    options: {
      responsive: true,
      scales: chartType !== 'pie' ? {
        y: { beginAtZero: true, title: { display: true, text: 'Quantity (kg)' } },
        x: { title: { display: true, text: 'Crop Type' } }
      } : {},
      plugins: {
        title: {
          display: true,
          text: 'Crop Storage Levels (Auto-updated every 1 min)',
          font: { size: 18 }
        },
        legend: { display: chartType === 'pie' }
      }
    }
  });
}

// üïí AUTO UPDATE EVERY 60s
fetchStorageData();
setInterval(fetchStorageData, 60000);

// üîÑ SWITCH CHART TYPES
function changeChartType(type) {
  chartType = type;
  
  fetchStorageData();
}
</script>
</body>
</html>
